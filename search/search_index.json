{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"GRLS GWAS Tutorial","text":"<p>The Golden Retriever Lifetime Study (GRLS) has a vast amount of phenotypic data collected from veterinarian records, and dog owners\u2019 questioners over years for 3,000+ dogs. In addition, the study has genotyped ~ 1.1 Million genetic markers using Axiom\u2122 Canine Genotyping Array Sets A and B. This reposatory should provide tutorials for handling of the GRLS phenotypic and genotypic data to produce successful GWAS studies</p>"},{"location":"#how-to-acess-the-grls-data","title":"How to acess the GRLS data?","text":""},{"location":"#21-genotyping-data","title":"2.1. Genotyping data","text":"<p>Affymetrix (thermofisher) Axiom Canine HD Array sets A and B were used to genotype the GRLS dogs. The data is avalible in PLINK and VCF formats. Instructions about geting access to the data will be announced soon.</p>"},{"location":"#22-phenotype-data","title":"2.2. Phenotype data","text":"<p>Morris Animal Foundation Data Commons provides open access to most of the data collected by the Golden Retriever Lifetime Study. An overview description of the study data can be found here. To download data tables, you need to register at the Data Commons.</p>"},{"location":"1.install/","title":"Environment Setup","text":""},{"location":"1.install/#1-setup","title":"1. Setup","text":""},{"location":"1.install/#11-install-conda","title":"1.1. Install conda","text":"<p>We are using conda to install softaware needed to run this tutorial. Here are the steps we used to install conda on a 64-bit computer with a Linux system using Miniconda. For other operating systems, you can find detailed instructions here</p> <pre><code>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh\nbash Miniconda3-latest-Linux-x86_64.sh\n</code></pre> <ul> <li>Follow the prompts on the installer screens and accept the defaults.</li> <li>Restart the terminal</li> </ul>"},{"location":"1.install/#12-create-new-environment-and-install-softaware-packages","title":"1.2. Create new environment and install softaware packages","text":"<p><pre><code>conda create -n grGWAS\nconda activate grGWAS\nconda install -c bioconda plink\nconda install -c bioconda plink2\nconda install -c bioconda bcftools\nconda install -c bioconda gcta\nconda install -c conda-forge r-base=4.3.1 r-ggplot2=3.4.2 r-gridextra=2.3\n</code></pre> </p>"},{"location":"2.Input_files/","title":"Input Description","text":""},{"location":"2.Input_files/#2-input-files","title":"2. Input files","text":""},{"location":"2.Input_files/#21-genotyping-data","title":"2.1. Genotyping data","text":"<ol> <li> <p>In this tutorial, we have the GRLS genotyping data of each array in a binary PLINK file format. You may use the PLINK documentation to read more about this file format. The genotyping analysis notes has detailed information on the bioinformatic pipeline used for genotyping and all notes that should be considered before any further analysis.</p> <ul> <li>The files of array A have the prefix \"output/setA/export_plink/AxiomGT1.bin\"</li> <li>The files of array B have the prefix \"output/setB/export_plink/AxiomGT1.bin\".</li> </ul> <p>Note: These PLINK files have the gender as predicted by the Axiom genotyping analysis tools. Check the genotyping analysis notes for details</p> </li> <li> <p>A text file that maps between sample IDs in the genotyping files, biological sample IDs, and the public IDs used in phenotype data files. Moreover, the file has gender information of the dogs as reported by their owners: <code>map_id_sex.tab</code></p> </li> </ol>"},{"location":"2.Input_files/#22-phenotype-data","title":"2.2. Phenotype data","text":"<p>In this tutorial, all phenotypes tables are located in a folder named <code>phenotypes</code>. We are using the Conditions - Neoplasia dataset as an example.</p> <p></p>"},{"location":"3.prep_arrays/","title":"Prep Array Sets","text":""},{"location":"3.prep_arrays/#3-preparation-of-array-sets-a-and-b-genotyping-data","title":"3. Preparation of Array sets A and B genotyping data","text":""},{"location":"3.prep_arrays/#31-replicate-snps","title":"3.1. replicate SNPs","text":"<p>Both arrays has a number of replicate SNPs which are usefull for QC but also require special attention for proper merging of the files of both arrays. We are using a QC merging mode of PLINK to identify mismatching nonmissing calls between the 2 arrays</p> <pre><code>plink --bfile output/setB/export_plink/AxiomGT1.bin --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n      --bmerge output/setA/export_plink/AxiomGT1.bin --merge-mode 7 \\\n      --output-chr 'chrM' --out AxiomGT1.mismatching7\n</code></pre> <p>Here is the output of this command</p> <p>3339 samples loaded from output/setB/export_plink/AxiomGT1.bin.fam.   3355 samples to be merged from output/setA/export_plink/AxiomGT1.bin.fam.   Of these, 17 are new, while 3338 are present in the base dataset.   547232 markers loaded from output/setB/export_plink/AxiomGT1.bin.bim.   397685 markers to be merged from output/setA/export_plink/AxiomGT1.bin.bim.   Of these, 368215 are new, while 29470 are present in the base dataset.   Warning: Variants 'Affx-206088448' and 'Affx-205939940' have the same position.   Warning: Variants 'Affx-205859745' and 'Affx-205344060' have the same position.   Warning: Variants 'Affx-206706550' and 'Affx-205359377' have the same position.   1460 more same-position warnings: see log file.   Performing 1-pass diff (mode 7), writing results to AxiomGT1.mismatching7.diff   98370860 overlapping calls, 97897061 nonmissing in both filesets.   97593330 concordant, for a concordance rate of 0.996897.  </p> <p>The concordance rate of nonmissing genotypes is pretty good (99.7%). However, we still have to handle two issues: </p> <ol> <li> <p>Mismatching genotypes: Let us have a closer look on the mismatching genotypes to see if they are uniformly distributed among the samples or not     <pre><code>tail -n+2 AxiomGT1.mismatching7.diff | awk '{print $2,$3}' | sort | uniq -c | sort -k1,1nr &gt; AxiomGT1.mismatching7.diff.samples\n</code></pre></p> <p>It seems that two samples show exceptional higher rate of mismatching (<code>GRLS S007258</code> and <code>GRLS S019740</code> have 11676 and 11440 mistmatches respectively. The latter sample is the only sample that was predicted to be female on Array A and male on array B according to the genotyping analysis notes). This likely indicates that these samples had something wrong. According to the the genotyping analysis notes, swapping the 2 samples on array B did not fix the issue. Therefore, we will exclude both samples from further analysis during the merging step. </p> </li> <li> <p>Variants having the same position: The mismatching analysis reveals 1463 markrs that has the same position on bith arrays but with different SNP IDs. Futher digging in the array annotation showed that most of these markers are idententical with minor differences in the flanking sequences. To avoid genotyping errors, we will exclude these SNPs from array B.</p> <pre><code>grep \"Warning: Variants .* have the same position\" AxiomGT1.mismatching7.log | awk -F\"'\" 'BEGIN{OFS=\"\\n\";}{print $2,$4}' &gt; same_pos.arrB.lst\nplink --bfile output/setB/export_plink/AxiomGT1.bin --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n  --exclude same_pos.arrB.lst \\\n  --make-bed --output-chr 'chrM' --out output/setB/export_plink/AxiomGT1.bin_noSamePos\n</code></pre> </li> </ol>"},{"location":"3.prep_arrays/#32-merging-of-array-sets-a-and-b-genotyping-data","title":"3.2. Merging of Array sets A and B Genotyping data","text":"<p>Now, we will merge the genotyping data of both arrays. For SNPs shared between the arrays, the genotypes of array A will overwrite the nonmissing calls in array B. Also, we will exclude the 2 samples with higher rates of non-concordance</p> <pre><code>echo \"GRLS S007258|GRLS S019740\" | tr '|' '\\n' &gt; swap_samples.lst\nplink --bfile output/setB/export_plink/AxiomGT1.bin_noSamePos --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n      --bmerge output/setA/export_plink/AxiomGT1.bin --merge-mode 3 \\\n      --remove swap_samples.lst \\\n      --make-bed --output-chr 'chrM' --out AxiomGT1v2.comp_merge\n</code></pre> <p>The output of the merging command gives some useful stastics</p> <p>...  Warning: 1355 het. haploid genotypes present (see AxiomGT1v2.comp_merge.hh );  Warning: Nonmissing nonmale Y chromosome genotype(s) present;  ...  Total genotyping rate in remaining samples is 0.994631.  913984 variants and 3354 samples pass filters and QC.  ...</p> <p>The first warning is is usually caused by male heterozygous calls in the X chromosome pseudo-autosomal region. Looking at <code>AxiomGT1v2.comp_merge.hh</code> shows that all the 1355 heterozygous haploid genotypes belong to sample <code>GRLS S005865</code>. According to the genotyping analysis notes, this sample is reported male in metadata as well as by the genotyping algorithm on Array B but the algorithm failed to predict its gender on array A. We will handle this sample later during the check for gender accuracy</p> <p>The second warning indicate that some nonmale samples have Y chromosome genotypes. Most PLINK commands treat these genotypes as missing. This behaviour is intended for safty however it makes it tricky to identify these markers. Here is some workaround to find these markers</p> <p><pre><code>mkdir -p temp_nonmale\ncat AxiomGT1v2.comp_merge.fam | awk '{if($5==\"2\")print}' &gt; temp_nonmale/female.lst\nplink --bfile AxiomGT1v2.comp_merge --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n      --keep temp_nonmale/female.lst --chr y \\\n      --recode --output-chr 'chrM' --out temp_nonmale/AxiomGT1v2.comp_merge.fe\n\nsed -i 's/chrY/chr_notY/' temp_nonmale/AxiomGT1v2.comp_merge.fe.map\n\nplink --file temp_nonmale/AxiomGT1v2.comp_merge.fe --chr-set 38 no-y --allow-no-sex --allow-extra-chr \\\n      --freq counts \\\n      --output-chr 'chrM' --out temp_nonmale/AxiomGT1v2.comp_merge.fe.explore\ntail -n+2 temp_nonmale/AxiomGT1v2.comp_merge.fe.explore.frq.counts | awk '{if($5!=0 || $6!=0)print}' | wc -l\n</code></pre> We were able to identify 37 markers nonmissing Y chromosome genotypes in females. These markers could be in the psudoautosomal region but unfortunately we do not have known boundries to those regions in dogs. As mentioned above, it is safe to ignore these markers in PLINK </p>"},{"location":"3.prep_arrays/#33-identification-and-removal-of-duplicate-samples","title":"3.3. Identification and removal of duplicate samples","text":"<p>Plink2 has an efficient function to calculate the KING-robust knickship estimator and filter duplicate samples as well. Duplicate samples have kinship coefficients ~0.5, first-degree relations (parent-child, full siblings) correspond to ~0.25, second-degree relations correspond to ~0.125, etc. Here, we are using the conventional cufoff ~0.354 (the geometric mean of 0.5 and 0.25) to identify and filter duplicate samples</p> <pre><code>plink2 --bfile AxiomGT1v2.comp_merge --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --king-cutoff 0.354 \\\n       --out AxiomGT1v2.comp_merge.nodup\n</code></pre> <p>Now, let us compare the files selected to be removed by Plink2 knickship versus the list of samples planned to run in duplicates. This code will identify all the samples planned to run in duplicates then find those remaining after exlcusion of the samples selected by the Plink2 knickship filter. We are expecting one replicate to remain from each group of replicate samples  <pre><code>awk 'BEGIN{FS=OFS=\"\\t\"}FNR==NR{a[$3]+=1;next}/^Family_ID/{print}{if(a[$3]&gt;1)print}' map_id_sex.tab map_id_sex.tab &gt; dup_samples.tab\nawk 'BEGIN{FS=OFS=\"\\t\"}FNR==NR{a[$1 FS $2]=1;next}{if(!a[$1 FS $2])print $0}' AxiomGT1v2.comp_merge.nodup.king.cutoff.out.id dup_samples.tab &gt; dup_samples_remain.tab\ntail -n+2 dup_samples_remain.tab | cut -f3 | sort | uniq -c | sort -k1,1nr\n</code></pre> Hear is the list of the remaining duplicates and their counts</p> <p>2 \u00a0\u00a0\u00a0 094-027376    1 \u00a0\u00a0\u00a0 094-002188    1 \u00a0\u00a0\u00a0 094-002396    1 \u00a0\u00a0\u00a0 094-002995    .    . </p> <p>It seems that 2 duplicates of sample <code>094-027376</code> are still remaining! Let's try to calculate their KING knickship to see how similar they are: <pre><code>grep 094-027376 dup_samples.tab &gt; failed_deDup.lst\nplink2 --bfile AxiomGT1v2.comp_merge --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --keep failed_deDup.lst --make-king-table \\\n       --out AxiomGT1v2.comp_merge.failed_deDup\ncat AxiomGT1v2.comp_merge.failed_deDup.kin0\n</code></pre></p> <p>Here is the output.  | FID1 | ID1       | FID2 | ID2       | NSNP   | HETHET    | IBS0      | KINSHIP    | | ---- | --------- | ---- | --------- | ------ | --------- | --------- | ---------- | | GRLS | S027376_2 | GRLS | S027376_1 | 879956 | 0.0645396 | 0.0414475 | -0.0559478 |</p> <p>It is obvious that these two samples are unlrelated. Therefore, we will exclude both of them with the duplicate samples selected by the Plink2 knickship filter. These are 120 samples in total so we will end up having 3234 samples in our output PLINK file <pre><code>plink2 --bfile AxiomGT1v2.comp_merge --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --remove &lt;(cat AxiomGT1v2.comp_merge.nodup.king.cutoff.out.id failed_deDup.lst) \\\n       --make-bed --output-chr 'chrM' --out AxiomGT1v2.comp_merge.deDup\n</code></pre></p>"},{"location":"3.prep_arrays/#34-check-for-gender-accuracy-remove-samples-with-wrong-gender-identities","title":"3.4. Check for gender accuracy &amp; remove samples with wrong gender identities","text":"<p>According to the genotyping analysis notes, there are two samples <code>GRLS S019740</code> and <code>GRLS S005865</code> that had discordant computed gender on the two arrays. The former was removed already because of the high rate of mismatching genotypes between the 2 arrays (see 3.1. replicate SNPs). The latter showed high rate heterozygous haploid genotypes despite being reported as male in metadata (see 3.2. Merging of Array sets). We will discard this sample from further analysis.</p> <p>Moreover, there are additional 9 samples with concordant gender on both arrays but different from the metadata. We can reproduce this information by known gender in metadata versus the computed gender based on genotyping data <pre><code>echo \"Family_ID Individual_ID computed_sex metadata_sex\" | tr ' ' '\\t' &gt; gender_conflict.lst\nawk 'BEGIN{FS=OFS=\"\\t\"}FNR==NR{a[$1 FS $2]=$5;next}{if(a[$1 FS $2] &amp;&amp; a[$1 FS $2]!=$5)print $1,$2,$5,a[$1 FS $2]}' map_id_sex.tab AxiomGT1v2.comp_merge.deDup.fam &gt;&gt; gender_conflict.lst\n</code></pre></p> <p>Wrong gender could be a mistake in the metadata or an indication for sample swap. Therefore, it is safer to exclude these samples from our genotyping data <pre><code>echo \"GRLS S005865\" | tr ' ' '\\t' &gt;&gt; gender_conflict.lst\nplink2 --bfile AxiomGT1v2.comp_merge.deDup --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --remove gender_conflict.lst \\\n       --make-bed --output-chr 'chrM' --out AxiomGT1v2.comp_merge.deDup.sexConfirm\n</code></pre> The output of our last PLINK command indeicate that our final file has 3224 samples (1615 females, 1609 males; 3224 founders)</p>"},{"location":"3.prep_arrays/#35-update-sample-ids-in-the-genotyping-files-to-match-the-phenotyping-files","title":"3.5. Update sample IDs in the genotyping files to match the phenotyping files","text":"<p>The data tables at Morris Animal Foundation Data Commons are using grls_ids (e.g. 094-000019) or public_ids (e.g. grlsH764T844). In this step, we will upadate the sample IDs in our genotyping files to match the grls_ids using the <code>map_id_sex.tab</code> file that maps between different types of IDs <pre><code>tail -n+2 map_id_sex.tab | awk 'BEGIN{FS=OFS=\"\\t\"}{print $1,$2,$1,$3}' &gt; grls_id.update.lst \nplink2 --bfile AxiomGT1v2.comp_merge.deDup.sexConfirm --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --update-ids grls_id.update.lst \\\n       --make-bed --output-chr 'chrM' --out AxiomGT1v2.comp_merge.deDup.sexConfirm.grls_ids\n</code></pre></p> <p>We can also do the same to upadate the sample IDs in our genotyping files to match the public_ids <pre><code>tail -n+2 map_id_sex.tab | awk 'BEGIN{FS=OFS=\"\\t\"}{print $1,$2,$1,$4}' &gt; public_ids.update.lst \nplink2 --bfile AxiomGT1v2.comp_merge.deDup.sexConfirm --chr-set 38 no-xy --allow-no-sex --allow-extra-chr \\\n       --update-ids public_ids.update.lst \\\n       --make-bed --output-chr 'chrM' --out AxiomGT1v2.comp_merge.deDup.sexConfirm.public_ids\n</code></pre></p>"},{"location":"4.qc_filter/","title":"QC & filtration","text":""},{"location":"4.qc_filter/#4-qc-and-filtration-of-genotyping-data","title":"4. QC and filtration of genotyping data","text":""},{"location":"4.qc_filter/#41-identifcation-of-1st-degree-relatives","title":"4.1. Identifcation of 1st degree relatives","text":"<p>Genotyping data can be used to assess sample-distances and thus identify sample duplications.  We will use 0.177 (the geometric mean of 0.25 and 0.125) as cutoff for the KING knickship  coeffiecients to identify 1st degree relatives.</p> <pre><code>mkdir -p gwas\nplink2 --bfile AxiomGT1v2.comp_merge.deDup.sexConfirm.grls_ids --chr-set 38 no-xy --allow-extra-chr \\\n       --king-cutoff 0.177 \\\n       --out gwas/AxiomGT1v2.1st_degree_relatives\n</code></pre> <p>Let us remove those relatives to avoid inflation of false associations in our GWAS</p> <pre><code>plink2 --bfile AxiomGT1v2.comp_merge.deDup.sexConfirm.grls_ids --chr-set 38 no-xy --allow-extra-chr \\\n       --remove gwas/AxiomGT1v2.1st_degree_relatives.king.cutoff.out.id \\\n       --make-bed --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives\n</code></pre>"},{"location":"4.qc_filter/#42-explore","title":"4.2. Explore","text":"<p>We use Plink commands to assess heterozygosity, missing genotyping, allele frequency, and hardy-weinberg equilibrium (HWE). The output are the files ending in \".het\", \".imiss (Per-individual)/.lmiss (per-variant)\", \".frq\", and \".hwe\"  </p> <pre><code>plink --bfile gwas/AxiomGT1v2.noRelatives --chr-set 38 no-xy --allow-extra-chr \\\n      --het --missing --freq --hardy   \\\n      --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.explore\n\n# We currentlky have:\n# 913984 variants loaded from .bim file.\n# 2519 samples (1279 males, 1240 females) loaded from .fam.\n</code></pre>"},{"location":"4.qc_filter/#421-extreme-cases-of-heterozygosity","title":"4.2.1. Extreme cases of heterozygosity:","text":"<p><pre><code>awk -v size=0.02 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($6/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i){if(i==0) print -1*size,size,a[i]/1;else if(i&lt;0) print (i-1)*size,i*size,a[i]/1;else print i*size,(i+1)*size,a[i]/1 }}'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.het) &gt; gwas/AxiomGT1v2.noRelatives.explore.het.histo \n\ncat gwas/AxiomGT1v2.noRelatives.explore.het | awk '{if($6&gt;0.3)print}' &gt;  gwas/AxiomGT1v2.noRelatives.explore.het.high ## high homozygosity\n\ncat gwas/AxiomGT1v2.noRelatives.explore.het | awk '{if(NR==1)print}{if($6&lt;-0.3)print}' &gt;  gwas/AxiomGT1v2.noRelatives.explore.het.low ## low homozygosity\n</code></pre> We can see at least 2 extreme cases. High heterozygosity may indicate sample contamination, however high homozygosity might just indicate higher inbreeding</p>"},{"location":"4.qc_filter/#422-genotype-missingness-in-samples-and-variants","title":"4.2.2. Genotype Missingness in samples and variants:","text":"<p><pre><code>awk -v size=0.02 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($6/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.imiss) &gt; gwas/AxiomGT1v2.noRelatives.explore.imiss.histo \n\nawk -v size=0.02 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($5/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.lmiss) &gt; gwas/AxiomGT1v2.noRelatives.explore.lmiss.histo \n</code></pre> Missingness per individual shows 13 samples with about ~57% genotyping rates. These samples were genotyped on one array but not the other. While missingness per variant shows 36 extreme variants with about 50% genotyping rates</p>"},{"location":"4.qc_filter/#423-variants-with-very-low-maf","title":"4.2.3. Variants with very low MAF:","text":"<p><pre><code>awk -v size=0.01 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($5/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.frq) &gt; gwas/AxiomGT1v2.noRelatives.explore.frq.histo \n\nawk -v size=0.001 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($5/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.frq) &gt; gwas/AxiomGT1v2.noRelatives.explore.frq.histo2 \n</code></pre> There are 331344 markers that have &lt; 1% MAF, 278461 markers have &lt; 0.1% MAF &amp; 314175 markers have &lt; 0.5% MAF</p>"},{"location":"4.qc_filter/#424-markers-with-significant-diviation-from-hwe","title":"4.2.4. Markers with significant diviation from HWE","text":"<p><pre><code>awk 'BEGIN{OFS=\"\\t\";}{ if($9&lt;1e-10)a[\"1e-10 or less\"]++;\n                       else if($9&lt;1e-8)a[\"1e-8:1e-9\"]++; else if($9&lt;1e-9)a[\"1e-9:1e-10\"]++; \\\n                       else if($9&lt;1e-7)a[\"1e-7:1e-8\"]++; else if($9&lt;1e-6)a[\"1e-6:1e-7\"]++; \\\n                       else if($9&lt;1e-5)a[\"1e-5:1e-6\"]++; else if($9&lt;1e-4)a[\"1e-4:1e-5\"]++; \\\n                       else if($9&lt;0.001)a[\"1e-3:1e-4\"]++; else if($9&lt;0.01)a[\"1e-2:1e-3\"]++; } \\\n                 END { for(i in a) print i,a[i] }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.explore.hwe) | sort -g &gt; gwas/AxiomGT1v2.noRelatives.explore.het.histo\n\ncat gwas/AxiomGT1v2.noRelatives.explore.hwe | awk '{if(NR==1)print}{if($9&lt;1e-10 )print}' &gt;  gwas/AxiomGT1v2.noRelatives.explore.hwe.low \n</code></pre> 1000s of SNPs show significant diviation from HWE, however this is an expected behaviour with selective breeding and artificial selection in dog breeds</p>"},{"location":"4.qc_filter/#43-filter","title":"4.3. Filter","text":"<p><pre><code>echo \"Oldies 094-040059\" &gt; gwas/het_excess.lst\nplink --bfile gwas/AxiomGT1v2.noRelatives --chr-set 38 no-xy --allow-extra-chr \\\n      --geno 0.05 --mind 0.05 --maf 0.01 \\\n      --remove gwas/het_excess.lst\\\n      --make-bed --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered\n</code></pre> Now, we have 582519 variants and 2505 samples that passed filters and QC.</p>"},{"location":"4.qc_filter/#44-ld-analysis","title":"4.4. LD analysis","text":""},{"location":"4.qc_filter/#441-ld-estimation","title":"4.4.1 LD estimation","text":"<ul> <li>--r2 reports squared inter-variant allele count correlations</li> <li>'in-phase' adds a column with in-phase allele pairs</li> <li>'dprime' adds the absolute value of Lewontin's D-prime statistic</li> </ul> <pre><code>plink --bfile gwas/AxiomGT1v2.noRelatives.filtered --chr-set 38 no-xy --allow-extra-chr \\\n      --r2 'in-phase' 'dprime' \\\n      --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.stats\n\nawk -v size=0.01 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($8/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.stats.ld) &gt; gwas/AxiomGT1v2.noRelatives.filtered.stats.ld.r2_histo ## 128035 sequential markers have complete linkage\nawk -v size=0.01 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($9/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.stats.ld) &gt; gwas/AxiomGT1v2.noRelatives.filtered.stats.ld.dprime_histo\n</code></pre>"},{"location":"4.qc_filter/#442-ld-pruning","title":"4.4.2 LD pruning","text":"<p>We will prune pairwise SNPs with R2 &gt;\u2009 0.2 (using windows of 100 SNPs and step size of 10 SNPs)</p> <pre><code>plink --bfile gwas/AxiomGT1v2.noRelatives.filtered --chr-set 38 no-xy --allow-extra-chr \\\n      --indep-pairwise 100 10 0.2 \\\n      --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_lst ## 567586 of 582519 variants removed.\n\nplink --bfile gwas/AxiomGT1v2.noRelatives.filtered --chr-set 38 no-xy --allow-extra-chr \\\n      --extract gwas/AxiomGT1v2.noRelatives.filtered.LD_lst.prune.in \\\n      --make-bed --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune ## 14933 variants remaining\n</code></pre>"},{"location":"4.qc_filter/#443-ld-re-evaluation","title":"4.4.3 LD re-evaluation","text":"<pre><code>plink --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune --chr-set 38 no-xy --allow-extra-chr \\\n      --freq --r2 'in-phase' 'dprime' \\\n      --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats\n\nawk -v size=0.01 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($8/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.ld) &gt; gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.ld.r2_histo\n\nawk -v size=0.01 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($9/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.ld) &gt; gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.ld.dprime_histo\n\nawk -v size=0.001 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($5/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i) print i*size,(i+1)*size,a[i]/1 }'  &lt;(tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.frq) &gt; gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.frq.histo2 ## 278461 markers have &lt; 0.1% MAF &amp; 314175 markers have &lt; 0.5% MAF\n\npaste gwas/AxiomGT1v2.noRelatives.filtered.stats.ld.r2_histo gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.stats.ld.r2_histo | less\n</code></pre>"},{"location":"4.qc_filter/#45-pca","title":"4.5. PCA","text":"<p>The <code>--pca</code> function in Plink2, similar to GCTA, extracts top principal components from the variance-standardized relationship matrix (i.e. genomic relationship matrix)</p> <pre><code>plink2 --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune --chr-set 38 no-xy --allow-extra-chr \\\n       --autosome --pca \\\n       --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.pca\n</code></pre> <p>I dentify the principle components that explain most of the variance:  <pre><code>Rscript -e 'val &lt;- read.table(\"gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.pca.eigenval\");'\\\n'val$varPerc &lt;- val$V1/sum(val$V1);'\\\n'jpeg(file = \"Var_PCs.jpg\");'\\\n'plot( x = seq(1:length(val$varPerc)), y = val$varPerc, type = \"o\",xlab = \"Principle Component\", ylab = \"Variance explained in %\");'\\\n'dev.off();'\n</code></pre></p> <p></p> <p>Plot the main principle components: <pre><code>Rscript -e 'require(ggplot2);require(gridExtra);'\\\n'eigenvec &lt;- read.table(\"gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.pca.eigenvec\", header = TRUE, comment.char=\"\");'\\\n'eigenvec$X.FID &lt;-  as.factor(eigenvec$X.FID);'\\\n'plot1 &lt;- ggplot(eigenvec, aes(x = PC1, y = PC2, col = X.FID)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC1\", y = \"PC2\");'\\\n'plot2 &lt;- ggplot(eigenvec, aes(x = PC3, y = PC4, col = X.FID)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC3\", y = \"PC4\");'\\\n'plot3 &lt;- ggplot(eigenvec, aes(x = PC1, y = PC3, col = X.FID)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC1\", y = \"PC3\");'\\\n'plot4 &lt;- ggplot(eigenvec, aes(x = PC2, y = PC3, col = X.FID)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC2\", y = \"PC3\");'\\\n'combined_plot &lt;- grid.arrange(plot1, plot2, plot3, plot4, nrow = 2);'\\\n'ggsave(\"pca_plot.png\", combined_plot, width = 12, height = 8, dpi = 400);'\n</code></pre></p> <p></p> <p>An additional tutorial of possible admixture analysis is here </p>"},{"location":"5.pheno/","title":"Phenotyping data","text":""},{"location":"5.pheno/#5-pre-process-the-skin-phenotypic-data","title":"5. Pre-process the Skin phenotypic data","text":""},{"location":"5.pheno/#51-identify-affected-cases-until-last-year","title":"5.1. Identify affected cases until last year","text":"<pre><code>cat phenotypes/conditions_skin.csv | awk 'BEGIN{FS=\",\"}\\\n    NR==1{print $0;next}{if ($5==1) {\\\n    if (!($1 in max_year) || $3 &gt; max_year[$1]) {\n        max_year[$1] = $3;\n        line[$1] = $0;\n    }}}END{for (id in line) {print line[id];}}' | tr ',' '\\t' &gt; gwas/conditions_skin_lastYear.tab\n</code></pre>"},{"location":"5.pheno/#52-explore-the-numbers-of-cases-for-each-phenotype","title":"5.2. Explore the numbers of cases for each phenotype","text":"<pre><code># Get the number of columns in the header\nnum_columns=$(head -n 1 \"gwas/conditions_skin_lastYear.tab\" | awk '{print NF}')\n# Loop over each column from the third till the last, and print the sum\nfor ((i=7; i&lt;=$num_columns; i++)); do\n    awk -v col=\"$i\" 'NR==1{dis=$col;next}{sum+=$col} END {print dis,sum}' gwas/conditions_skin_lastYear.tab\ndone &gt; gwas/conditions_skin.no_of_cases\n</code></pre>"},{"location":"5.pheno/#53-sample-selection","title":"5.3. Sample selection","text":""},{"location":"5.pheno/#531-select-cases-of-a-target-phenotype","title":"5.3.1 Select \"cases\" of a target phenotype","text":"<pre><code>target=\"atopy\"\nTcol=$(head -n 1 \"gwas/conditions_skin_lastYear.tab\" | awk -v pheno=\"$target\" '{for (i=7; i&lt;=NF; i++){if($i==pheno)print i}}')\nawk -v Tcol=\"$Tcol\" 'NR==1{print;next}{if($Tcol==\"1\")print}' gwas/conditions_skin_lastYear.tab &gt; gwas/conditions_${target}_lastYear.tab\n\ntail -n+2 gwas/conditions_${target}_lastYear.tab | cut -d\" \" -f1 &gt; gwas/${target}_cases.ids\n</code></pre>"},{"location":"5.pheno/#532-check-for-co-existing-conditions","title":"5.3.2 Check for co-existing conditions","text":"<p><pre><code>for ((i=7; i&lt;=$num_columns; i++)); do\n    awk -v col=\"$i\" 'NR==1{dis=$col;next}{sum+=$col} END {if(sum)print dis,sum}' gwas/conditions_${target}_lastYear.tab\ndone\n</code></pre> For now, we will not exclude any samples from cases</p>"},{"location":"5.pheno/#533-identify-individuals-to-be-excluded-from-controls","title":"5.3.3. Identify individuals to be excluded from controls","text":"<pre><code>grep 'allergic_reaction\\|seasonal_allergy\\|angioedema\\|facial_edema\\|.*_dermatitis\\|r_o_atopy\\|vaccine_reaction' gwas/conditions_skin.no_of_cases &gt; gwas/${target}.to_be_excluded.lst\nwhile read offTarget;do\n  echo $offTarget\n  offTcol=$(head -n 1 \"gwas/conditions_skin_lastYear.tab\" | awk -v pheno=\"$offTarget\" '{for (i=7; i&lt;=NF; i++){if($i==pheno)print i}}')\n  awk -v Tcol=\"$Tcol\" -v offTcol=\"$offTcol\" 'NR&gt;1{if($Tcol!=\"1\" &amp;&amp; $offTcol==\"1\")print $1}' gwas/conditions_skin_lastYear.tab\ndone &lt; &lt;(cut -d\" \" -f1 gwas/${target}.to_be_excluded.lst) | sort | uniq &gt; gwas/${target}.to_be_excluded.ids\n</code></pre>"},{"location":"5.pheno/#54-remove-the-excluded-samples-from-the-genotyping-dataset","title":"5.4. Remove the excluded samples from the genotyping dataset","text":"<p><pre><code>cat gwas/${target}.to_be_excluded.ids | grep -Fwf - gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.fam &gt; gwas/${target}.to_be_excluded.samples\nplink --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune --chr-set 38 no-xy --allow-extra-chr \\\n      --remove gwas/${target}.to_be_excluded.samples --maf 0.01 \\\n      --make-bed --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.${target}\n</code></pre> There are 14864 variants and 1885 samples that passed filters and QC.</p>"},{"location":"5.pheno/#55-generate-the-phenotype-file","title":"5.5. generate the phenotype file","text":"<pre><code>awk 'FNR==NR{a[$1]=1;next}{if(!a[$2])print $1,$2,\"1\";else print $1,$2,\"2\";}' gwas/${target}_cases.ids gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.${target}.fam &gt; gwas/${target}.pheno\ncat gwas/${target}.pheno | cut -d\" \" -f3 | sort | uniq -c ## we have 240 cases and 1645 controls\n</code></pre>"},{"location":"5.pheno/#56-assess-distribution-of-cases-in-pca","title":"5.6. Assess distribution of cases in PCA","text":"<pre><code>plink2 --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.${target} --chr-set 38 no-xy --allow-extra-chr \\\n       --autosome --pca \\\n       --output-chr 'chrM' --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.${target}.pca\n\nRscript -e 'require(ggplot2);require(gridExtra);'\\\n'eigenvec &lt;- read.table(\"gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.atopy.pca.eigenvec\", header = TRUE, comment.char=\"\");'\\\n'pheno &lt;- read.table(\"gwas/atopy.pheno\", header = FALSE, comment.char=\"\");'\\\n'names(pheno) &lt;- c(\"FID\", \"IID\", \"pheno\");'\\\n'pheno$pheno[pheno$pheno == \"1\"] &lt;- \"Unaffected\";pheno$pheno[pheno$pheno == \"2\"] &lt;- \"Affected\";'\\\n'ph_eigenvec &lt;-  merge(pheno, eigenvec, by = \"IID\");'\\\n'ph_eigenvec$pheno &lt;-  as.factor(ph_eigenvec$pheno);'\\\n'plot1 &lt;- ggplot(ph_eigenvec, aes(x = PC1, y = PC2, col = pheno)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC1\", y = \"PC2\");'\\\n'plot2 &lt;- ggplot(ph_eigenvec, aes(x = PC3, y = PC4, col = pheno)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC3\", y = \"PC4\");'\\\n'plot3 &lt;- ggplot(ph_eigenvec, aes(x = PC1, y = PC3, col = pheno)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC1\", y = \"PC3\");'\\\n'plot4 &lt;- ggplot(ph_eigenvec, aes(x = PC2, y = PC3, col = pheno)) + geom_point() + labs(title = \"PCA Plot\", x = \"PC2\", y = \"PC3\");'\\\n'combined_plot &lt;- grid.arrange(plot1, plot2, plot3, plot4, nrow = 2);'\\\n'ggsave(\"pca_plot_atopy.png\", combined_plot, width = 12, height = 8, dpi = 400);'\n</code></pre>"},{"location":"6.heritability/","title":"Heritability","text":""},{"location":"6.heritability/#6-assessment-of-heritability","title":"6. Assessment of heritability","text":"<p>We are using GCTA software to perform the GREML analysis for heritability assessment </p> <p>The <code>--reml</code> command of GCTA estimates the proportion of phenotypic variance that can be explained by SNPs. Here is a more detailed explaination of the GREML method and the undelying linear mixed model. </p> <p>In brief, GREML utilizes the genetic relationships between individuals in a sample population, captured in a genomic relationship matrix (GRM), to partition the phenotypic variance into its genetic and residual components. By fitting a linear mixed model, GREML estimates the proportion of variance attributable to all SNPs.</p> <p>The summary result of REML analysis will be saved in a plain text file (*.hsq).</p>"},{"location":"6.heritability/#61-gcta-grm","title":"6.1. GCTA-GRM","text":"<ul> <li>This command calculates the genetic relationship matrix (GRM) from all the autosomal SNPs.</li> <li>GCTA receives PLINK binary PED files as input. However, we have to tweak our Plink files to update the chromosome names into a numerical format and remove all extra chromosmes.  </li> <li>Data needs to be filtered to remove rare SNPs (e.g. --maf 0.01), and cryptic relatedness (e.g. --grm-cutoff 0.025). Our dataset does not need any further filtration</li> </ul> <pre><code>## a) Prepare the Plink input files\nplink --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune --chr-set 38 no-xy --allow-extra-chr '0' \\\n      --make-bed --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta\n\n## b) Run the GCTA-GRM command\ngcta64 --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta --autosome-num 38 --autosome --make-grm \\\n       --out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm --thread-num 10\n</code></pre>"},{"location":"6.heritability/#62-input-phenotype-data","title":"6.2. Input phenotype data","text":"<p>The input phenotype file is a plain text file similar to that of Plink. If the phenotypic value is coded as 0 or 1 (or 1 and 2, compatible with PLINK), then it will be recognized as a case-control study (0 for controls and 1 for cases). Missing value should be represented by \"-9\" or \"NA\". </p> <p>For this tutorial, we will use the file <code>gwas/atopy.pheno</code> that has 240 atopy cases and 1645 controls</p>"},{"location":"6.heritability/#63-covariates","title":"6.3. Covariates","text":"<p>We can adjust for quantitative and discrete covariates. Previous PCA analysis showed that three principle components explain most of the variance and non of them segregates with our phenotype of interest. Therfore, we will adjust the GREML analysis for these 3 eigenvectors. Also, we will adjust for possible gender effect.</p> <p>We already have this information but we need to reformat to match the GCTA expectations:</p> <pre><code>tail -n+2 gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.pca.eigenvec | cut -f1-5 &gt; gwas/3PCs.txt\ncat gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta.fam | awk '{print $1,$2,$5}' &gt; gwas/gender.txt\n</code></pre>"},{"location":"6.heritability/#64-breeding-value","title":"6.4. Breeding value","text":"<p>A breeding value is an estimate of an animal's genetic merit for a particular trait. The additional command <code>--reml-pred-rand</code> predicts the total genetic effect (i.e. breeding value) of each individual attributed by the aggregative effect of the SNPs used to estimate the GRM. The total genetic effects of all the individuals will be saved in a plain ext file *.indi.blp.</p>"},{"location":"6.heritability/#65-run-gcta-greml","title":"6.5. Run GCTA-GREML","text":"<p>Now, we have all the pieces we need to run the analysis </p> <p>Note: You do not have to have exactly the same individuals in these files. GCTA will find the individuals in common in the files and sort the order of the individuals.</p> <pre><code>gcta64 --reml --grm gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm \\\n       --pheno gwas/${target}.pheno \\\n       --qcovar gwas/3PCs.txt --covar gwas/gender.txt \\\n       --reml-pred-rand \\\n       --out gwas/${target}_greml --thread-num 10\n</code></pre> <p>Here is the ouput:</p> <pre><code>*******************************************************************\n* Genome-wide Complex Trait Analysis (GCTA)\n* version v1.94.1 Linux\n* Built at Nov 15 2022 21:14:25, by GCC 8.5\n* (C) 2010-present, Yang Lab, Westlake University\n* Please report bugs to Jian Yang &lt;jian.yang@westlake.edu.cn&gt;\n*******************************************************************\nAnalysis started at 22:53:07 PDT on Sun Aug 20 2023.\nHostname: farm\n\nAccepted options:\n--reml\n--grm gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm\n--pheno gwas/atopy.pheno\n--qcovar gwas/3PCs.txt\n--covar gwas/gender.txt\n--reml-pred-rand\n--out gwas/atopy_greml\n--thread-num 10\n\nNote: the program will be running on 10 threads.\n\nReading IDs of the GRM from [gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm.grm.id].\n2505 IDs are read from [gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm.grm.id].\nReading the GRM from [gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm.grm.bin].\nGRM for 2505 individuals are included from [gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.gcta_grm.grm.bin].\nReading phenotypes from [gwas/atopy.pheno].\nNon-missing phenotypes of 1885 individuals are included from [gwas/atopy.pheno].\nReading quantitative covariate(s) from [gwas/3PCs.txt].\n3 quantitative covariate(s) of 2505 individuals are included from [gwas/3PCs.txt].\nReading discrete covariate(s) from [gwas/gender.txt].\n1 discrete covariate(s) of 2505 individuals are included from [gwas/gender.txt].\nAssuming a disease phenotype for a case-control study: 240 cases and 1645 controls \nNote: you can specify the disease prevalence by the option --prevalence so that GCTA can transform the variance explained to the underlying liability scale.\n3 quantitative variable(s) included as covariate(s).\n1 discrete variable(s) included as covariate(s).\n1885 individuals are in common in these files.\n\nPerforming  REML analysis ... (Note: may take hours depending on sample size).\n1885 observations, 5 fixed effect(s), and 2 variance component(s)(including residual variance).\nCalculating prior values of variance components by EM-REML ...\nUpdated prior values: 0.0552258  0.065765\nlogL: 1050.57\nRunning AI-REML algorithm ...\nIter.   logL    V(G)    V(e)\n1       1072.79 0.03423 0.07855\n2       1101.13 0.02239 0.08760\n3       1113.95 0.01543 0.09386\n4       1119.64 0.01118 0.09814\n5       1122.17 0.00851 0.10105\n6       1123.29 0.00681 0.10301\n7       1123.79 0.00571 0.10434\n8       1124.01 0.00341 0.10719\n9       1124.20 0.00354 0.10711\n10      1124.20 0.00354 0.10711\n11      1124.20 0.00354 0.10711\nLog-likelihood ratio converged.\n\nCalculating the logLikelihood for the reduced model ...\n(variance component 1 is dropped from the model)\nCalculating prior values of variance components by EM-REML ...\nUpdated prior values: 0.11055\nlogL: 1123.70754\nRunning AI-REML algorithm ...\nIter.   logL    V(e)\n1       1123.72 0.11055\n2       1123.72 0.11055\nLog-likelihood ratio converged.\n\nSummary result of REML analysis:\nSource  Variance        SE\nV(G)    0.003536        0.003863\nV(e)    0.107112        0.005044\nVp      0.110648        0.003616\nV(G)/Vp 0.031961        0.034835\n\nSampling variance/covariance of the estimates of variance components:\n1.492491e-05    -1.364512e-05\n-1.364512e-05   2.543986e-05\n\nSummary result of REML analysis has been saved in the file [gwas/atopy_greml.hsq].\n\nBLUP solutions of the genetic effects for 1885 individuals have been saved in the file [gwas/atopy_greml.indi.blp].\n\nAnalysis finished at 22:53:17 PDT on Sun Aug 20 2023\nOverall computational time: 9.85 sec.\n</code></pre>"},{"location":"6.heritability/#63-interpretation-of-results","title":"6.3. Interpretation of results","text":"<p>a) <code>gwas/atopy_greml.hsq</code>: The output file of the <code>--reml</code> command  *  V(G), V(e) and Vp for genetic variance, residual variance, and phenotypic variance respectively. *  Note that Vp =  V(G) + V(e) *  V(G)/Vp represents the proportion of phenotypic variance explained by SNPs. Our results here indicate that SNPs can explain 3% only of the phenotypic variance  *  The standard error (SE) is importnat to judge the reliability of the results. A 95% confidence interval (CI) is approximately h2-SNP estimate +/- 1.96 * SE. If the SE is too large, the 95% CI will cover the whole parameter space (from 0 to 1) so that you won't be able to make any meaningful inference from the estimate. Therefore, a value of SE &lt; 0.1 is needed to have reliable results *  logL is the log likelihood for the full model (the null hypothesis that \u03c32g \u2260 0).  *  logL0 is the log likelihood for the reduced model (the null hypothesis that \u03c32g = 0).  *  LRT is the log-likelihood ratio test statistic. It is calculated as twice the difference in log-likelihood between the full (h2 \u2260 0) and reduced (h2 = 0) models. i.e. LRT = 2[logL - logL0]  * Degree of freedom (df), p-value, and sample size  For more information about the full and reduced models and the interpretation of log likelihoods and LRT, check here</p> <p>b) <code>gwas/atopy_greml.indi.blp</code>:  The output file of the <code>--reml-pred-rand</code> command  *  columns are family ID, individual ID, an intermediate variable, the total genetic effect, another intermediate variable and the residual effect.</p> <pre><code>awk -v size=0.02 'BEGIN{OFS=\"\\t\";bmin=bmax=0}{ b=int($6/size); a[b]++; bmax=b&gt;bmax?b:bmax; bmin=b&lt;bmin?b:bmin } END { for(i=bmin;i&lt;=bmax;++i){if(i==0) print -1*size,size,a[i]/1;else if(i&lt;0) print (i-1)*size,i*size,a[i]/1;else print i*size,(i+1)*size,a[i]/1 }}' gwas/atopy_greml.indi.blp &gt; gwas/atopy_greml.indi.blp_histo\n</code></pre> <p>Note:  GCTA has additional valuble options e.g. <code>--gxe</code> to estimate the variance of genotype-environment (GE) interaction and <code>--prevalence</code> to transform the estimate of variance explained, V(1)/Vp, on the observed scale to that on the underlying scale, V(1)/Vp_L. Check GCTA's documentation for details </p>"},{"location":"ext_docs/GREML_analysis/","title":"GREML analysis","text":""},{"location":"ext_docs/GREML_analysis/#gcta-greml-analysis","title":"GCTA-GREML analysis","text":"<p>The narrow-sense heritability (h2) is defined as the proportion of phenotypic variance due to additive genetic variance. GREML (Genomic-relatedness-based restricted maximum likelihood) is a method used to estimate the proportion of variance in a phenotype that can be explained by SNPs in a population. In other words, GREML calculates the SNP-based heritability.</p> <p>GREML utilizes the genetic relationships between individuals in a sample population, captured in a genomic relationship matrix (GRM), to partition the phenotypic variance into its genetic and residual components. By fitting a linear mixed model, GREML estimates the proportion of variance attributable to all SNPs.</p> <p>Let us dive deeper into linear mixed models (LMM) and how they are used in the context of this genomic analysis:</p> <p>1. Basics of Linear Models:  In simple linear regression, we model the relationship between a dependent variable (phenotype) and one or more independent variables (often genotypic data). The model is described as:</p> <p>Y=X\u03b2+\u03f5</p> <p>Where:</p> <ul> <li>Y is the vector of phenotypic values.</li> <li>X is the design matrix for the fixed effects.</li> <li>\u03b2 is a vector of fixed effect coefficients.</li> <li>\u03f5 is the vector of random errors.</li> </ul> <p></p> <p>2. Mixed Models Add a Random Component:  In mixed models, besides fixed effects (like the \u03b2 in the linear model), there are random effects which capture variability in the data due to certain groups or clusters.</p> <p>Y=X\u03b2+Zu+\u03f5</p> <p>Where:</p> <ul> <li>Z is the design matrix for the random effects.</li> <li>u is the vector of random effects.</li> </ul> <p></p> <p>3. Application to Genomic Data:  In the context of GREML and genomic studies:</p> <ul> <li>The fixed effects (\u03b2) might capture known factors influencing the phenotype, like age or gender.</li> <li>The random effects (u) capture the genetic effects of all SNPs. These are assumed to follow a multivariate normal distribution with mean zero and variance-covariance matrix G\u03c32g, where G is the genomic relationship matrix (GRM) and \u03c32g is the genetic variance.</li> <li>The residuals \u03f5 are also assumed to be normally distributed with mean zero and a variance-covariance matrix I\u03c32e, where I is the identity matrix and \u03c32e is the error variance.</li> </ul> <p></p> <p>4. Estimating the Variance Components:  The key goal in GREML is to estimate the \u03c32g (genetic variance) and \u03c32e (residual variance). From these, we can compute the SNP-based heritability as:</p> <p>h2 = \u03c32g / (\u03c32g + \u03c32e)</p> <p>This quantifies the proportion of the phenotypic variance explained by the SNPs.</p> <p></p> <p>5. Restricted Maximum Likelihood (REML):  The REML approach is used to estimate the variance components in the model. REML provides unbiased estimates of variance components under a wide range of situations.</p> <p>In summary, by using a linear mixed model, the GREML approach leverages both fixed (known factors) and random (genetic effects of SNPs) components to partition and quantify the variability in the observed phenotype. This enables researchers to pinpoint how much of the phenotypic variance can be attributed to genetics as captured by SNPs.</p> <p></p> <p>6. statistical varification:  For GCTA to assess the importance of the SNPs' effects to the model, it fits and compare 2 models:</p> <p>a) Full Model that includes both the fixed effects and the random effects.  b) Reduced Model that only includes the fixed effects and omits the random effects of SNPs. </p> <p>GCTA calculate the Log Likelihoods for both models. A higher log likelihood indicates a better fit of the model to the data. The difference in log likelihoods between the full and reduced models provides a test statistic for the significance of the random effects (SNP effects). Essentially, if the full model (which includes SNP effects) has a significantly better fit to the data than the reduced model (which excludes SNP effects), it implies that the SNPs are explaining a significant portion of the variance in the phenotype.</p> <p>Formally, the difference in log likelihoods between the two models, multiplied by two, approximately follows a chi-squared distribution. This can be used for hypothesis testing: 2 (LogLikelihoodfull \u2212 LogLikelihoodreduced)</p> <p>You can learn more about linear mixed models here</p>"},{"location":"ext_docs/admixture_analysis/","title":"Admixture analysis","text":""},{"location":"ext_docs/admixture_analysis/#admixture-analysis","title":"Admixture Analysis","text":""},{"location":"ext_docs/admixture_analysis/#1-install","title":"1. install","text":"<pre><code>conda install -c bioconda admixture=1.3.0\n</code></pre>"},{"location":"ext_docs/admixture_analysis/#2-remove-non-autosomal-markers-and-change-chr-names-to-intigers","title":"2. remove non-autosomal markers and change chr names to intigers","text":"<pre><code>plink --bfile gwas/AxiomGT1v2.noRelatives.filtered.LD_prune --chr-set 38 no-xy --allow-extra-chr \\\n      --autosome \\\n      --make-bed -out gwas/AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes\n</code></pre>"},{"location":"ext_docs/admixture_analysis/#3-run-admixture-in-the-cross-validation-mode-to-find-out-the-best-number-of-ancestries","title":"3. Run Admixture in the cross validation mode to find out the best number of ancestries","text":"<pre><code>cd gwas\nfor k in {1..10};do echo $k;\n  admixture -j8 --cv AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.bed $k | tee log${k}.out\ndone\ngrep \"^CV error\" log*.out | cut -d\":\" -f1,3 | sed 's/log//;s/\\.out://' | sort -k1,1n &gt; admix_cv.txt\n\nRscript -e 'val &lt;- read.table(\"admix_cv.txt\");'\\\n'jpeg(file = \"admix_cv.jpg\");'\\\n'plot( x = val$V1, y = val$V2, type = \"o\",xlab = \"K Ancestry\", ylab = \"CV error\");'\\\n'dev.off();'\n</code></pre> <p>There is an output file for each parameter set: Q (the ancestry fractions), and P (the allele frequencies of the inferred ancestral populations). </p>"},{"location":"ext_docs/admixture_analysis/#4-plot-the-q-estimates","title":"4. plot the Q estimates","text":"<pre><code>sort -k1,3nr AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.3.Q &gt; AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.3.Q.sorted\nRscript -e 'tbl=read.table(\"AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.3.Q.sorted\");'\\\n'jpeg(file = \"ancestries.jpg\");'\\\n'barplot(t(as.matrix(tbl)), col=rainbow(3),xlab=\"Individual #\", ylab=\"Ancestry\", border=NA);'\\\n'dev.off();'\n</code></pre>"},{"location":"ext_docs/admixture_analysis/#5-plot-the-q-estimates-of-a-selected-subset-of-individuals","title":"5. plot the Q estimates of a selected subset of individuals","text":"<pre><code>tail -n+2 AxiomGT1v2.noRelatives.filtered.LD_prune.pca.eigenvec | awk '{if($3&lt;0.02 &amp;&amp; $4&gt;0.03)print $1,$2}' &gt; pc2_extreme\npaste AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.3.Q  AxiomGT1v2.noRelatives.filtered.LD_prune.autosomes.fam | grep -wf pc2_extreme &gt; pc2_extreme.Q\necho Population Percent Individual &gt; subset_ancestry.txt\ncat pc2_extreme.Q | awk '{for (a = 1; a &lt;= 3; a++)print \"Pop\"a,$a,$4\".\"$5}' &gt;&gt; subset_ancestry.txt\n\nRscript -e 'data &lt;- read.table(\"subset_ancestry.txt\",header = TRUE);'\\\n'library(ggplot2);'\\\n'bar &lt;- ggplot(data, aes(fill=Population, y=Percent, x=factor(Individual))) +'\\\n'geom_bar(position=\"stack\", stat=\"identity\") + ggtitle(\"Admixture ancestries\");'\\\n'bar2 &lt;- bar + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 4));'\\\n'ggsave(\"subset_ancestries.png\", bar2, width = 12, height = 6, dpi = 400);'\n</code></pre>"},{"location":"ext_docs/sample_distance/","title":"Sample distance","text":""},{"location":"ext_docs/sample_distance/#sample-distance-and-similarity-matrices","title":"Sample-distance and similarity matrices","text":"<p>Assessemnt of similairty between studied individual is useful to identify sample duplications or unexpected outliers. Moreover, it is critical to adjust for hidden population structure. A pairwise similarity can be calculated by counting the alleles descended from a common ancestor (i.e. Identity by descent; IBD) and/or alleles that are the same, irrespective of whether they are inherited from a recent ancestor (i.e. Identity by state; IBS).</p> <p>Pedigree information allow us to figure out the expected proportion of shared alleles by descent and thus IBD distances within families. However, the proposed pedigree is not uncommon to be wrong. With genotyping arrays and sequecning, marker information can be used to calculate IBS or IBD similarity matrices and predict the actual pedigree structure </p> <p>VanRaden (2008) and Yang et al. (2010) described the genomic relationship matrix (GRM) as a a covariance matrix which uses identical by state (IBS) information scaled by the allele frequencies, as shared rare alleles are more likely to be IBD than common alleles. These methods do not explicitly differentiate between IBD and IBS information Clark et al. (2012).</p> <p>GRM uses the minor allele frequencies (MAFs) of genotyped SNPs assuming a homogeneous population structure which is not always a true assumption. KING-robust estimation is an alternative approach that does not need MAFs. This techqniue is more trusted in mixed-population datasets (unless the parents are from very different populations).</p> <p>In the GRLS study, we can use either techqniues safely. Therefore, we will use the KING-robust kinship estimator in this tutorial. According to the PLINK2 documentation, the KING kinship coefficients are scaled such that duplicate samples have kinship 0.5.  Accordingly, first-degree relations (parent-child, full siblings) correspond to ~0.25, second-degree relations correspond to ~0.125, etc.  It is conventional to use a cutoff of ~0.354 (the geometric mean of 0.5 and 0.25) to screen for monozygotic twins and duplicate samples, ~0.177 to add first-degree relations, etc.</p>"}]}